<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CÃ´ng cá»¥ HD SaiSon</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
*{box-sizing:border-box;font-family:Roboto}
body{background:#f0f4f8;padding-top:56px}

/* LOGIN */
#loginScreen{
  position:fixed;inset:0;
  background:linear-gradient(135deg,#007bff,#00c6ff);
  display:flex;align-items:center;justify-content:center;
  z-index:9999
}
.login-box{
  background:#fff;padding:30px;width:320px;border-radius:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);text-align:center
}

/* HEADER */
header{
  position:fixed;top:0;left:0;right:0;height:56px;
  background:#fff;display:flex;align-items:center;
  justify-content:space-between;padding:0 15px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);z-index:1000
}
.logo{font-weight:700;color:#007bff}
.desktop-nav a{margin-left:15px;text-decoration:none;color:#333}
@media(max-width:768px){.desktop-nav{display:none}}

/* CONTENT */
.container-custom{
  max-width:520px;margin:auto;background:#fff;padding:20px;
  border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.1)
}
label{font-weight:500}
input{text-align:right;font-size:16px;padding:12px}

.result{
  margin-top:20px;padding:15px;background:#e7f3ff;
  border-left:5px solid #007bff;border-radius:12px
}
.plan-box{
  background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;
  border:1px solid #e3eaf3;box-shadow:0 4px 12px rgba(0,0,0,.08);
  position:relative;
  cursor:pointer;
  transition:.25s;
}
.plan-row{display:flex;justify-content:space-between;font-size:14px}
.plan-row .value{font-weight:600;color:#0d47a1}
.plan-row.total .value{color:#e53935;font-weight:700}
.divider{height:1px;background:#e0e0e0;margin:8px 0}

/* BEST PLAN */
.best-plan{
  border:2px solid #2e7d32!important;
  background:#e8f5e9
}
.best-plan::before{
  content:"ğŸ’° Ráºº NHáº¤T";
  position:absolute;top:-10px;right:10px;
  background:#2e7d32;color:#fff;
  font-size:12px;padding:2px 8px;border-radius:12px
}

/* CLICK HIGHLIGHT */
.plan-box.active{
  border:3px solid #ff9800 !important;
  background:#fff3e0;
  box-shadow:0 6px 18px rgba(255,152,0,.4);
}
.plan-box.active::after{
  content:"ğŸ‘‰ KHÃCH CHá»ŒN";
  position:absolute;
  top:-10px;
  left:10px;
  background:#ff9800;
  color:#fff;
  font-size:12px;
  padding:2px 8px;
  border-radius:12px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <h4>ğŸ” ÄÄƒng nháº­p</h4>
    <input id="loginKey" type="password" class="form-control mb-3" placeholder="Nháº­p khoÃ¡">
    <button class="btn btn-primary w-100" onclick="login()">XÃ¡c nháº­n</button>
    <p id="loginError" class="text-danger mt-2"></p>
  </div>
</div>

<!-- ===== HEADER ===== -->
    <header>
      <div class="logo">ğŸš— Batch 41</div>

      <!-- DESKTOP NAV -->
      <nav class="desktop-nav">
        <a href="index.html">TÃ­nh tráº£ gÃ³p</a>
        <a href="check_old.html">TÃ­nh tuá»•i</a>
        <a href="cancel_contract.html">Huá»· HÄ</a>
        <a href="#" onclick="logout()">ÄÄƒng xuáº¥t</a>
      </nav>

      <!-- HAMBURGER -->
      <button
        class="btn btn-outline-primary d-md-none"
        data-bs-toggle="offcanvas"
        data-bs-target="#mobileMenu"
      >
        â˜°
      </button>
    </header>

    <!-- ===== MOBILE MENU ===== -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="mobileMenu">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">ğŸš— Batch 41</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
        ></button>
      </div>
      <div class="offcanvas-body">
        <a class="btn btn-light w-100 mb-2" href="index.html">ğŸ“Š TÃ­nh tráº£ gÃ³p</a>
        <a class="btn btn-light w-100 mb-2" href="check_old.html">ğŸ‚ TÃ­nh tuá»•i</a>
        <a class="btn btn-light w-100 mb-2" href="cancel_contract.html">âŒ Huá»· há»£p Ä‘á»“ng</a>
        <hr />
        <button class="btn btn-danger w-100" onclick="logout()">ğŸ” ÄÄƒng xuáº¥t</button>
      </div>
    </div>

<!-- CONTENT -->
<div class="container-custom mt-3">
<h5 class="text-center">TÃNH TRáº¢ GÃ“P XE</h5>

<label>GiÃ¡ xe</label>
<input id="giaXe" class="form-control mb-3" oninput="onGiaXeChange()">

<label>Tráº£ trÆ°á»›c (VNÄ)</label>
<input id="traTien" class="form-control mb-3" oninput="onTraTienChange()">

<label>Tráº£ trÆ°á»›c (%)</label>
<input id="traPercent" class="form-control mb-2" oninput="onTraPercentChange()">

<div class="d-flex gap-2 mb-3">
  <button class="btn btn-outline-secondary w-100" onclick="setPercent(20)">20%</button>
  <button class="btn btn-outline-secondary w-100" onclick="setPercent(30)">30%</button>
  <button class="btn btn-outline-secondary w-100" onclick="setPercent(40)">40%</button>
</div>

<div class="d-flex gap-2 mb-3">
  <button id="btn099" class="btn btn-primary w-100" onclick="setPackage(0.99)">0.99</button>
  <button id="btn089" class="btn btn-secondary w-100" onclick="setPackage(0.89)">0.89</button>
  <button id="btn166" class="btn btn-secondary w-100" onclick="setPackage(1.66)">1.66</button>
</div>

<div id="result" class="result" style="display:none"></div>

<button class="btn btn-warning w-100 mt-2" onclick="exportImage()">ğŸ“¸ Xuáº¥t áº£nh gá»­i Zalo</button>
</div>

<script>
const ACCESS_KEY="B41";
function login(){loginKey.value===ACCESS_KEY?(loginScreen.style.display="none",sessionStorage.setItem("logged","1")):loginError.innerText="Sai khoÃ¡"}
function logout(){sessionStorage.clear();location.reload()}
window.onload=()=>{if(sessionStorage.getItem("logged")==="1")loginScreen.style.display="none"}

const heSo99={9:0.126179,12:0.098233,15:0.081497,18:0.070365,21:0.06244,24:0.05651,36:0.042809};
const heSo089={9:0.12517,12:0.09723,15:0.08049,18:0.06936,21:0.06143,24:0.05548};
const heSo166={18:0.07719,21:0.069355,24:0.063512,36:0.050251};

let currentPackage=0.99,lock=false;

const format=n=>n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");
const parse=v=>parseFloat(v.replace(/\./g,""))||0;
const ceil=n=>Math.ceil(n/1000)*1000;
const formatInput=el=>el.value=format(el.value.replace(/\D/g,""));

function setPercent(p){traPercent.value=p;onTraPercentChange()}
function setPackage(p){
  currentPackage=p;
  btn099.className=p===0.99?"btn btn-primary w-100":"btn btn-secondary w-100";
  btn089.className=p===0.89?"btn btn-primary w-100":"btn btn-secondary w-100";
  btn166.className=p===1.66?"btn btn-primary w-100":"btn btn-secondary w-100";
  autoTinh();
}

function onGiaXeChange(){formatInput(giaXe);autoTinh()}
function onTraTienChange(){
  if(lock)return;lock=true;
  formatInput(traTien);
  if(parse(giaXe.value)>0)
    traPercent.value=((parse(traTien.value)/parse(giaXe.value))*100).toFixed(2);
  lock=false;autoTinh();
}
function onTraPercentChange(){
  if(lock)return;lock=true;
  traTien.value=format(ceil(parse(giaXe.value)*parseFloat(traPercent.value||0)/100));
  lock=false;autoTinh();
}

function autoTinh(){
  if(parse(giaXe.value)>0 && parse(traTien.value)<parse(giaXe.value)) tinhTraGop();
  else result.style.display="none";
}

function tinhTraGop(){
  const vay=parse(giaXe.value)-parse(traTien.value);
  const heSo=currentPackage===0.99?heSo99:currentPackage===0.89?heSo089:heSo166;

  let min=Infinity,plans=[];
  for(let t in heSo){
    const thang=ceil(vay*heSo[t]+12000);
    const lai=thang*t-vay;
    if(lai<min)min=lai;
    plans.push({t,thang,lai});
  }

  let html=`<b>GiÃ¡ xe:</b> ${format(giaXe.value)} Ä‘<br>
            <b>Tráº£ trÆ°á»›c:</b> ${format(traTien.value)} Ä‘<br>
            <b>Khoáº£n vay:</b> ${format(vay)} Ä‘<br><br>`;
  plans.forEach(p=>{
    html+=`
    <div class="plan-box ${p.lai===min?'best-plan':''}" onclick="selectPlan(this)">
      <div class="plan-row"><strong>${p.t} thÃ¡ng</strong></div>
      <div class="plan-row"><span>Tráº£/thÃ¡ng</span><span class="value">${format(p.thang)} Ä‘</span></div>
      <div class="divider"></div>
      <div class="plan-row total"><span>Tá»•ng lÃ£i</span><span class="value">${format(p.lai)} Ä‘</span></div>
    </div>`;
  });

  result.innerHTML=html;
  result.style.display="block";
}

function selectPlan(el){
  document.querySelectorAll('.plan-box').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
}

function exportImage(){
  if(result.style.display==="none")return alert("ChÆ°a cÃ³ dá»¯ liá»‡u");
  html2canvas(result).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL();
    a.download="bang-tra-gop-hdsaison.png";
    a.click();
  });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
